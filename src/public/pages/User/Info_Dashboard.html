<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Patient Info - Medicis (demo)</title>
  <base href="/pages/User/"> 
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div class="sidebar">
        <div class="logo-container">
            <h1 class="logo">Medicis +</h1>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a class="nav-btn active" href="/redirect/patientinfo"><span class="icon">üë§</span> Patient Profile</a></li>
                <li><a class="nav-btn" href="/redirect/appointment"><span class="icon">üìÖ</span> Appointments</a></li>
                <li><a class="nav-btn" href="/redirect/billing"><span class="icon">üí≥</span> Billing</a></li>
            </ul>
        </nav>
        <div class="sidebar-footer">
            <button class="footer-btn"><span class="icon">‚ùì</span> Support</button>
            <div class="account-info">
                <button class="footer-btn"><span class="icon">üë§</span> My Account</button>
                <p class="patient-id">Patient ID: <span id="patient-id-display">1234</span></p>
            </div>
        </div>
    </div>

    <div class="main-content">
        <!-- Patient Profile (copied) -->
        <div id="patient-profile" class="page active">
            <div class="page-header" style="position: relative;">
                <h1 id="patient-name-header">JUAN DELA CRUZ</h1>
                <p class="patient-id-header">Patient ID: <span id="patient-id-header">1234</span></p>
                <button id="signout-button" class="btn-secondary signout-top" title="Sign out" style="position: absolute; top: 15px; right: 10px;">Sign Out</button>
                <hr>
            </div>
            <div class="patient-info-container">
                <div class="patient-avatar">
                    <img alt="avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='35' r='20' fill='%233e0079'/%3E%3Cpath d='M20 100 Q20 70 50 70 Q80 70 80 100' fill='%233e0079'/%3E%3C/svg%3E">
                </div>
                <div class="patient-details">
                    <h2>Patient Information</h2>
                    <div class="info-grid">
                        <div class="info-row"><label>Name: </label><span id="info-name"></span></div>
                        <div class="info-row"><label>ID: </label><span id="info-id"></span></div>
                        <div class="info-row"><label>Sex: </label><span id="info-sex"></span></div>
                        <div class="info-row"><label>Age: </label><span id="info-age"></span></div>
                        <div class="info-row"><label>Date of Birth: </label><span id="info-date_of_birth"></span></div>
                        <div class="info-row"><label>Address: </label><span id="info-address"></span></div>
                        <div class="info-row"><label>Email: </label><span id="info-email"></span></div>
                        <div class="info-row"><label>Phone: </label><span id="info-phone"></span></div>

                    </div>
                    <button id="update-info-btn" class="btn-primary">Update Information</button>
                </div>
            </div>
        </div>

      <!-- Edit Patient Information Modal (keep it here) -->
<div id="edit-overlay" class="edit-overlay" hidden>
    <div class="edit-panel" role="dialog" aria-modal="true" aria-labelledby="edit-title">
        <div class="edit-header">
            <h2 id="edit-title">Update Patient Information</h2>
        </div>
        <form id="edit-form" class="edit-form" novalidate>
            <div class="form-grid">
                <div class="form-field">
                    <label for="input-name">Full Name</label>
                    <input id="input-name" name="name" type="text" placeholder="Enter full name" required>
                </div>
                <div class="form-field">
                    <label for="input-sex">Sex</label>
                    <select id="input-sex" name="sex" required>
                        <option value="">Select Sex...</option>
                        <option value="MALE">MALE</option>
                        <option value="FEMALE">FEMALE</option>
                    </select>
                </div>

                <div class="form-field">
                    <label for="input-date_of_birth">Date of Birth</label>
                    <input id="input-date_of_birth" name="date_of_birth" type="date">
                </div>
                <div class="form-field" style="grid-column: 1 / -1;">
                    <label for="input-address">Address</label>
                    <input id="input-address" name="address" type="text" placeholder="Enter address">
                </div>
                <div class="form-field">
                    <label for="input-email">Email</label>
                    <input id="input-email" name="email" type="email" placeholder="Enter email address">
                </div>
                <div class="form-field">
                    <label for="input-phone">Phone Number</label>
                    <input id="input-phone" name="phone" type="tel" placeholder="Enter phone number">
                </div>
            </div>
            <div class="edit-actions">
                <button type="submit" id="save-edit-btn" class="btn-primary">Save Changes</button>
                <button type="button" id="cancel-edit-btn" class="btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
</div>


  <script src="script.js"></script>
  <script>
    function renderPatientInfo(patientData) {
        document.getElementById('patient-name-header').textContent = (patientData.name || '').toUpperCase();
        document.getElementById('patient-id-header').textContent = patientData.patient_id || '';
        document.getElementById('patient-id-display') && (document.getElementById('patient-id-display').textContent = patientData.patient_id || '');
        document.getElementById('info-name') && (document.getElementById('info-name').textContent = patientData.name || '');
        document.getElementById('info-id') && (document.getElementById('info-id').textContent = patientData.user_id || '');
        document.getElementById('info-sex') && (document.getElementById('info-sex').textContent = patientData.sex || '');
        document.getElementById('info-age') && (document.getElementById('info-age').textContent = patientData.age ?? '');
        
        document.getElementById('info-date_of_birth').textContent = patientData.date_of_birth || new Date();
        
        document.getElementById('info-address') && (document.getElementById('info-address').textContent = patientData.address || '');
        document.getElementById('info-email') && (document.getElementById('info-email').textContent = patientData.email || '');
        document.getElementById('info-phone') && (document.getElementById('info-phone').textContent = patientData.phone || '');

        const apptName = document.getElementById('appt-user-name'); if (apptName) apptName.textContent = patientData.name || '';
        const billingName = document.getElementById('billing-user-name'); if (billingName) billingName.textContent = patientData.name || '';
    }


let patientData = {}
async function loadPatientInfo() {
  try {
    const response = await fetch('/patients/loadpatientinfo');
    if (!response.ok) throw new Error('Failed to fetch patient info');
    patientData = await response.json(); 
   
    if(patientData){
        renderPatientInfo(patientData);
    }
  } catch (error) {
    console.error('Error fetching patient info:', error);
  }
}
document.addEventListener('DOMContentLoaded', loadPatientInfo);

async function Logout() {
    try {
        const response = await fetch('/patients/logout', {
            method: 'GET',
            credentials: 'include',

            redirect: 'follow' 
        });
        if (response.ok) {
            window.location.href = '/'; 
        } else if (response.status === 302) {
            const redirectUrl = response.headers.get('Location');
            if (redirectUrl) {
                console.log("Redirecting manually via Location header:", redirectUrl);
                window.location.href = redirectUrl;
            } else {

                window.location.href = '/'; 
            }

        } else {

            alert(`Logout failed with status ${response.status}.`);
        }
    } catch (error) {
        console.error('Network error during sign out:', error);
        alert('A network error occurred during sign out.');
    }
}

const signoutButton = document.getElementById('signout-button');

if (signoutButton) {
    signoutButton.addEventListener('click', (e) => {
        e.preventDefault(); 
        Logout();
    });
}

</script>
</body>
</html>
